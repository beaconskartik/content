<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infrastructure Capacity Reference - Airbnb System Design</title>
<style>
  :root {
    --primary: #FF5A5F;
    --primary-dark: #E04850;
    --secondary: #00A699;
    --accent: #FC642D;
    --purple: #7B2FF7;
    --blue: #428BF9;
    --dark: #ffffff;
    --darker: #f1f5f9;
    --card-bg: #ffffff;
    --card-border: #e2e8f0;
    --text: #1e293b;
    --text-muted: #4b5563;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--dark);
    color: var(--text);
    line-height: 1.7;
    scroll-behavior: smooth;
  }
  /* HERO */
  .hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6B73FF 100%);
    padding: 50px 40px;
    text-align: center;
    border-bottom: 3px solid var(--blue);
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(circle at 30% 50%, rgba(66,139,249,0.06) 0%, transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(0,166,153,0.08) 0%, transparent 50%);
  }
  .hero h1 {
    font-size: 2.6em;
    background: linear-gradient(135deg, var(--blue), var(--secondary), var(--purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    margin-bottom: 10px;
  }
  .hero .subtitle { font-size: 1.1em; color: rgba(255,255,255,0.9); position: relative; }
  .hero .back-link {
    display: inline-block;
    margin-top: 15px;
    color: #ffffff;
    text-decoration: none;
    font-size: 0.95em;
    position: relative;
    border: 1px solid var(--secondary);
    padding: 6px 18px;
    border-radius: 20px;
    transition: all 0.3s;
  }
  .hero .back-link:hover { background: rgba(255,255,255,0.15); }
  .badge {
    display: inline-block;
    padding: 4px 14px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
    margin: 5px;
  }
  .badge-blue { background: rgba(255,255,255,0.15); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); }
  .badge-green { background: rgba(0,166,153,0.2); color: #ffffff; border: 1px solid var(--secondary); }
  .badge-purple { background: rgba(255,255,255,0.15); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); }
  /* NAV */
  .toc {
    background: #f8fafc;
    padding: 20px 40px;
    border-bottom: 1px solid var(--card-border);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .toc h2 { color: var(--secondary); margin-bottom: 10px; font-size: 1em; text-transform: uppercase; letter-spacing: 2px; }
  .toc-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .toc a {
    color: var(--text-muted);
    text-decoration: none;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.85em;
    border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    transition: all 0.3s;
    white-space: nowrap;
  }
  .toc a:hover, .toc a:focus {
    color: var(--blue);
    border-color: var(--blue);
    background: rgba(66,139,249,0.08);
  }
  /* CONTAINER */
  .container { max-width: 1400px; margin: 0 auto; padding: 30px 40px; }
  section { margin-bottom: 50px; }
  section > h2 {
    font-size: 1.8em;
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px; height: 40px;
    border-radius: 10px;
    font-size: 1.2em;
  }
  h3 {
    font-size: 1.3em;
    color: var(--blue);
    margin: 25px 0 15px;
  }
  /* CARDS */
  .card {
    background: var(--card-bg);
    border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    transition: border-color 0.3s;
  }
  .card:hover { border-color: var(--blue); }
  .card h4 {
    font-size: 1.15em;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
  }
  /* TABLES */
  .table-wrap {
    overflow-x: auto;
    border-radius: 12px;
    border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
  }
  th {
    background: #f8fafc;
    padding: 14px 16px;
    text-align: left;
    font-weight: 600;
    color: #1e293b;
    border-bottom: 2px solid #e5e7eb;
    position: sticky;
    top: 0;
    white-space: nowrap;
  }
  td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--card-border);
    vertical-align: top;
  }
  tr:hover td { background: rgba(66,139,249,0.04); }
  tr:last-child td { border-bottom: none; }
  .service-name {
    font-weight: 700;
    white-space: nowrap;
  }
  .service-pg { color: var(--blue); }
  .service-mysql { color: #00758f; }
  .service-es { color: #FEC514; }
  .service-redis { color: #DC382D; }
  .service-mongo { color: #00ED64; }
  .service-cassandra { color: #1287B1; }
  .service-dynamo { color: var(--accent); }
  .service-kafka { color: var(--text); }
  /* METRIC CARDS */
  .metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
  }
  .metric-card {
    background: var(--card-bg);
    border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border-radius: 10px;
    padding: 18px;
    text-align: center;
  }
  .metric-card .value {
    font-size: 1.8em;
    font-weight: 800;
    line-height: 1.2;
  }
  .metric-card .label {
    font-size: 0.82em;
    color: var(--text-muted);
    margin-top: 5px;
  }
  /* BAR CHARTS */
  .bar-chart { margin: 20px 0; }
  .bar-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    gap: 12px;
  }
  .bar-label {
    width: 130px;
    font-size: 0.85em;
    text-align: right;
    flex-shrink: 0;
    font-weight: 600;
  }
  .bar-track {
    flex: 1;
    height: 28px;
    background: #f8fafc;
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }
  .bar-fill {
    height: 100%;
    border-radius: 6px;
    display: flex;
    align-items: center;
    padding-left: 10px;
    font-size: 0.78em;
    font-weight: 600;
    color: #fff;
    white-space: nowrap;
    transition: width 0.8s ease;
  }
  /* COMPARISON BADGES */
  .compare-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75em;
    font-weight: 600;
    margin: 1px 2px;
  }
  .cb-read { background: rgba(66,139,249,0.2); color: var(--blue); }
  .cb-write { background: rgba(255,90,95,0.2); color: var(--primary); }
  .cb-latency { background: rgba(0,166,153,0.2); color: #ffffff; }
  .cb-cost { background: rgba(245,158,11,0.2); color: var(--warning); }
  /* TIPS */
  .tip-box {
    border-left: 4px solid var(--warning);
    background: rgba(245,158,11,0.06);
    padding: 18px 22px;
    border-radius: 0 10px 10px 0;
    margin: 20px 0;
    font-size: 0.92em;
  }
  .tip-box strong { color: var(--warning); }
  .tip-box.tip-info {
    border-left-color: var(--blue);
    background: rgba(66,139,249,0.06);
  }
  .tip-box.tip-info strong { color: var(--blue); }
  .tip-box.tip-success {
    border-left-color: var(--success);
    background: rgba(16,185,129,0.06);
  }
  .tip-box.tip-success strong { color: var(--success); }
  .tip-box.tip-danger {
    border-left-color: var(--danger);
    background: rgba(239,68,68,0.06);
  }
  .tip-box.tip-danger strong { color: var(--danger); }
  /* CODE */
  code {
    background: rgba(66,139,249,0.15);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Cascadia Code', 'Fira Code', monospace;
    font-size: 0.88em;
  }
  /* TAGS */
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.75em;
    font-weight: 600;
    margin: 2px;
  }
  .tag-read { background: rgba(66,139,249,0.15); color: var(--blue); }
  .tag-write { background: rgba(255,90,95,0.15); color: var(--primary); }
  .tag-both { background: rgba(123,47,247,0.15); color: var(--purple); }
  .tag-managed { background: rgba(255,255,255,0.15); color: #ffffff; }
  .tag-serverless { background: rgba(245,158,11,0.15); color: var(--warning); }
  /* DECISION MATRIX */
  .decision-cell {
    text-align: center;
    font-weight: 700;
  }
  .score-5 { color: var(--success); }
  .score-4 { color: #6ee7b7; }
  .score-3 { color: var(--warning); }
  .score-2 { color: var(--accent); }
  .score-1 { color: var(--danger); }
  /* FOOTER */
  footer {
    text-align: center;
    padding: 30px;
    color: var(--text-muted);
    border-top: 1px solid #e5e7eb;
    font-size: 0.85em;
  }
  footer a { color: var(--secondary); text-decoration: none; }
  /* RESPONSIVE */
  @media (max-width: 768px) {
    .hero { padding: 30px 20px; }
    .hero h1 { font-size: 1.8em; }
    .container { padding: 20px 15px; }
    .toc { padding: 15px; }
    .bar-label { width: 90px; font-size: 0.78em; }
    .card-grid { grid-template-columns: 1fr; }
    table { font-size: 0.8em; }
    th, td { padding: 8px 10px; }
  }
  /* === DIAGRAM ZOOM CONTROLS === */
  .diagram-box { position: relative; }
  .diagram-zoom-controls {
    position: absolute; top: 12px; right: 12px; z-index: 10;
    display: flex; gap: 4px; opacity: 0.5; transition: opacity 0.3s;
  }
  .diagram-box:hover .diagram-zoom-controls { opacity: 1; }
  .diagram-zoom-controls button {
    width: 32px; height: 32px; border-radius: 8px; border: 1px solid #e5e7eb;
    background: #ffffff; color: #1e293b; cursor: pointer; font-size: 16px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s;
    font-family: system-ui; line-height: 1; padding: 0;
  }
  .diagram-zoom-controls button:hover { background: #f1f5f9; border-color: var(--blue); color: var(--blue); }
  .diagram-zoom-controls button:active { transform: scale(0.95); }
  .diagram-zoom-controls .zoom-level {
    font-size: 11px; color: #64748b; display: flex; align-items: center;
    padding: 0 6px; font-weight: 600; min-width: 40px; justify-content: center;
  }
  .diagram-box svg { transition: transform 0.3s ease; transform-origin: center center; }
  .diagram-box.fullscreen {
    position: fixed !important; top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: 9999; background: #ffffff; border-radius: 0; padding: 20px;
    display: flex; align-items: center; justify-content: center;
    overflow: auto;
  }
  .diagram-box.fullscreen .diagram-zoom-controls { opacity: 1; top: 20px; right: 20px; }
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <h1>Infrastructure Capacity Reference</h1>
  <p class="subtitle">Single-Instance Throughput, Latency, Storage &amp; Cost Benchmarks</p>
  <div style="margin-top:12px; position:relative;">
    <span class="badge badge-blue">Sharding Decisions</span>
    <span class="badge badge-green">Cost Optimization</span>
    <span class="badge badge-purple">Interview Ready</span>
  </div>
  <a class="back-link" href="index.html">&larr; Back to Airbnb System Design</a>
</div>

<!-- NAV -->
<nav class="toc">
  <h2>Quick Navigation</h2>
  <div class="toc-grid">
    <a href="#overview">Overview</a>
    <a href="#mega-table">Master Comparison</a>
    <a href="#postgresql">PostgreSQL</a>
    <a href="#mysql">MySQL</a>
    <a href="#elasticsearch">Elasticsearch</a>
    <a href="#redis">Redis</a>
    <a href="#mongodb">MongoDB</a>
    <a href="#cassandra">Cassandra</a>
    <a href="#dynamodb">DynamoDB / Cosmos DB</a>
    <a href="#kafka">Kafka / Event Hubs</a>
    <a href="#throughput-visual">Visual Comparisons</a>
    <a href="#shard-decision">When to Shard?</a>
    <a href="#cost-comparison">Cost Comparison</a>
    <a href="#interview-cheat">Interview Cheat Sheet</a>
  </div>
</nav>

<div class="container">

<!-- ==================== OVERVIEW ==================== -->
<section id="overview">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--blue),var(--secondary));">&#128202;</span> Why This Page Exists</h2>
  <div class="card">
    <p>When designing systems at scale, the single most important question is: <strong>"When do I need to shard / partition / add replicas?"</strong></p>
    <p style="margin-top:12px;">The answer depends on knowing the <em>single-instance limits</em> of each technology. This page gives you concrete numbers for:</p>
    <ul style="margin:12px 0 0 20px;">
      <li><strong>Read &amp; Write Throughput</strong> &mdash; How many QPS / TPS can one instance handle?</li>
      <li><strong>Latency</strong> &mdash; What p50 / p99 latencies should you expect?</li>
      <li><strong>Storage</strong> &mdash; How much data before performance degrades?</li>
      <li><strong>Connections</strong> &mdash; How many concurrent clients can connect?</li>
      <li><strong>Cost</strong> &mdash; What does a production-grade instance cost across AWS / Azure / GCP?</li>
    </ul>
    <div class="tip-box tip-info" style="margin-top:18px;">
      <strong>Interview Tip:</strong> Knowing these numbers by heart lets you quickly calculate <em>"Do I need 1 instance or 10?"</em> in a system design interview. For example, if your system needs 200K reads/sec and Redis handles 100K ops/sec on a single instance, you know you need at least 2 Redis nodes (plus replicas for HA).
    </div>
  </div>
</section>

<!-- ==================== MASTER COMPARISON TABLE ==================== -->
<section id="mega-table">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--primary),var(--accent));">&#128293;</span> Master Comparison Table</h2>
  <p style="margin-bottom:15px; color:var(--text-muted);">Single-instance (or single-node) benchmarks. All numbers are approximate and vary with hardware, config, and workload.</p>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Service</th>
          <th>Type</th>
          <th>Read Throughput</th>
          <th>Write Throughput</th>
          <th>p50 Latency</th>
          <th>p99 Latency</th>
          <th>Max Connections</th>
          <th>Recommended Storage Limit</th>
          <th>Monthly Cost (Mid-Tier)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="service-name service-pg">PostgreSQL</span></td>
          <td><span class="tag tag-both">RDBMS</span></td>
          <td>5K &ndash; 70K QPS</td>
          <td>2K &ndash; 15K TPS</td>
          <td>1 &ndash; 5 ms</td>
          <td>10 &ndash; 30 ms</td>
          <td>500 (default), 10K+ tuned</td>
          <td>1 &ndash; 5 TB (shard beyond)</td>
          <td>$200 &ndash; $500</td>
        </tr>
        <tr>
          <td><span class="service-name service-mysql">MySQL</span></td>
          <td><span class="tag tag-both">RDBMS</span></td>
          <td>10K &ndash; 230K QPS</td>
          <td>2K &ndash; 19K TPS</td>
          <td>1 &ndash; 5 ms</td>
          <td>10 &ndash; 30 ms</td>
          <td>151 (default), 100K max</td>
          <td>1 TB (shard beyond)</td>
          <td>$150 &ndash; $350</td>
        </tr>
        <tr>
          <td><span class="service-name service-es">Elasticsearch</span></td>
          <td><span class="tag tag-read">Search</span></td>
          <td>100 &ndash; 700 QPS/node</td>
          <td>5K &ndash; 20K docs/sec</td>
          <td>5 &ndash; 50 ms</td>
          <td>100 &ndash; 500 ms</td>
          <td>HTTP (pool-based)</td>
          <td>30 &ndash; 50 GB/shard, &lt; 20 shards/node</td>
          <td>$300 &ndash; $800</td>
        </tr>
        <tr>
          <td><span class="service-name service-redis">Redis</span></td>
          <td><span class="tag tag-read">Cache / KV</span></td>
          <td>80K &ndash; 100K ops/sec</td>
          <td>80K &ndash; 100K ops/sec</td>
          <td>&lt; 1 ms</td>
          <td>1 &ndash; 2 ms</td>
          <td>10,000 (default)</td>
          <td>25 GB (single node RAM)</td>
          <td>$50 &ndash; $300</td>
        </tr>
        <tr>
          <td><span class="service-name service-mongo">MongoDB</span></td>
          <td><span class="tag tag-both">Document DB</span></td>
          <td>10K &ndash; 100K ops/sec</td>
          <td>5K &ndash; 50K ops/sec</td>
          <td>0.5 &ndash; 2 ms (cached)</td>
          <td>5 &ndash; 50 ms</td>
          <td>1,500/node (Atlas M10)</td>
          <td>3 TB per collection</td>
          <td>$200 &ndash; $400</td>
        </tr>
        <tr>
          <td><span class="service-name service-cassandra">Cassandra</span></td>
          <td><span class="tag tag-write">Wide-Column</span></td>
          <td>10K &ndash; 100K reads/sec</td>
          <td>50K &ndash; 200K writes/sec</td>
          <td>1 &ndash; 3 ms</td>
          <td>6 &ndash; 20 ms</td>
          <td>Unlimited (OS limited)</td>
          <td>500 GB &ndash; 1 TB/node</td>
          <td>$300 &ndash; $600/node</td>
        </tr>
        <tr>
          <td><span class="service-name service-dynamo">DynamoDB</span></td>
          <td><span class="tag tag-serverless">Serverless KV</span></td>
          <td>12K reads/sec (initial burst)</td>
          <td>4K writes/sec (initial burst)</td>
          <td>2 &ndash; 5 ms</td>
          <td>6 &ndash; 10 ms</td>
          <td>HTTP API (no limit)</td>
          <td>Unlimited (400 KB/item)</td>
          <td>$45 &ndash; $450 (provisioned)</td>
        </tr>
        <tr>
          <td><span class="service-name service-dynamo">Cosmos DB</span></td>
          <td><span class="tag tag-serverless">Multi-Model</span></td>
          <td>RU-based (similar to Dynamo)</td>
          <td>RU-based (similar to Dynamo)</td>
          <td>2 &ndash; 5 ms</td>
          <td>6 &ndash; 10 ms</td>
          <td>HTTP API (no limit)</td>
          <td>Unlimited</td>
          <td>$24 &ndash; $584 (RU-based)</td>
        </tr>
        <tr>
          <td><span class="service-name service-kafka">Kafka</span></td>
          <td><span class="tag tag-write">Event Stream</span></td>
          <td colspan="2" style="text-align:center;">100K &ndash; 200K msg/sec per broker</td>
          <td>10 &ndash; 50 ms</td>
          <td>50 &ndash; 100 ms</td>
          <td>100K+ per broker</td>
          <td>Retention-based (7 days default)</td>
          <td>$330 &ndash; $440 (3-broker MSK)</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="tip-box">
    <strong>Reading This Table:</strong> These are <em>single-instance</em> numbers under moderate production workloads. Your mileage will vary based on instance type, indexing, query complexity, and network. Use as order-of-magnitude reference for capacity planning.
  </div>
</section>

<!-- ==================== POSTGRESQL ==================== -->
<section id="postgresql">
  <h2><span class="icon" style="background:linear-gradient(135deg,#336791,#428BF9);">&#128024;</span> PostgreSQL</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">READ</span> Read Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Minimal (2 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:1%;background:var(--blue);">~740 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Small (4 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:3.5%;background:var(--blue);">~2,500 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Mid-Range (8 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:7%;background:var(--blue);">~5,000 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">High-End (32+ vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--blue),var(--secondary));">~70,000 QPS</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">WRITE</span> Write Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Minimal</span>
          <div class="bar-track"><div class="bar-fill" style="width:3%;background:var(--primary);">~500 TPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Small</span>
          <div class="bar-track"><div class="bar-fill" style="width:10%;background:var(--primary);">~1,500 TPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Mid-Range</span>
          <div class="bar-track"><div class="bar-fill" style="width:33%;background:var(--primary);">~5,000 TPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">High-End (tuned)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--primary),var(--accent));">~15,000 TPS</div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">Default Connections</td><td><code>max_connections = 100</code> (typically set to 200&ndash;500 in production)</td></tr>
        <tr><td style="font-weight:600;">Connection Pooling</td><td>Use PgBouncer or pgpool-II &mdash; essential for &gt;500 connections (each PG connection = ~10 MB RAM)</td></tr>
        <tr><td style="font-weight:600;">p50 / p99 Latency</td><td>1&ndash;5 ms / 10&ndash;30 ms (simple queries on indexed columns)</td></tr>
        <tr><td style="font-weight:600;">Max Table Size</td><td>32 TB per table (theoretical), degrade ~beyond 500 GB without partitioning</td></tr>
        <tr><td style="font-weight:600;">Max Row Size</td><td>1.6 TB per row (TOAST), 400 GB practical</td></tr>
        <tr><td style="font-weight:600;">MVCC Overhead</td><td>Dead tuples require VACUUM &mdash; autovacuum must be tuned for write-heavy workloads</td></tr>
        <tr><td style="font-weight:600;">Replication</td><td>Streaming replication (async/sync), logical replication for selective table sync</td></tr>
        <tr><td style="font-weight:600;">Sharding</td><td>Not native &mdash; use Citus extension, application-level sharding, or foreign data wrappers</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>AWS RDS</th><th>Azure Database</th><th>GCP Cloud SQL</th></tr></thead>
        <tbody>
          <tr><td>Small (2 vCPU, 8 GB)</td><td>$100 &ndash; $150</td><td>$100 &ndash; $140</td><td>$90 &ndash; $130</td></tr>
          <tr><td>Mid (4 vCPU, 16 GB)</td><td>$200 &ndash; $350</td><td>$200 &ndash; $320</td><td>$180 &ndash; $280</td></tr>
          <tr><td>Large (8 vCPU, 32 GB)</td><td>$400 &ndash; $600</td><td>$380 &ndash; $580</td><td>$350 &ndash; $520</td></tr>
          <tr><td>XL (16 vCPU, 64 GB)</td><td>$800 &ndash; $1,200</td><td>$750 &ndash; $1,100</td><td>$700 &ndash; $1,000</td></tr>
        </tbody>
      </table>
    </div>
    <p style="color:var(--text-muted);font-size:0.85em;">+ Storage: $0.10&ndash;$0.12/GB-month &bull; + IOPS: $0.06&ndash;$0.10 per provisioned IOP &bull; + Backups &amp; snapshots</p>
  </div>
  <div class="tip-box tip-success">
    <strong>When to Shard PostgreSQL:</strong> When single-node storage exceeds 1&ndash;5 TB, or write throughput exceeds 10K&ndash;15K TPS, or replication lag becomes unacceptable. First try: read replicas, partitioning, connection pooling, query optimization. Then: Citus for transparent sharding.
  </div>
</section>

<!-- ==================== MYSQL ==================== -->
<section id="mysql">
  <h2><span class="icon" style="background:linear-gradient(135deg,#00758f,#F29111);">&#128172;</span> MySQL</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">READ</span> Read Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Small (2 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:4%;background:#00758f;">~10K QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Mid (8 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:22%;background:#00758f;">~50K QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Large (32 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#00758f,#F29111);">~230K QPS</div></div>
        </div>
      </div>
      <p style="color:var(--text-muted);font-size:0.85em;">CPU-bound read-only benchmarks. Complex queries with joins reduce these significantly.</p>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">WRITE</span> Write Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Basic (3K IOPS)</span>
          <div class="bar-track"><div class="bar-fill" style="width:15%;background:var(--primary);">~2K TPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Mid (10K IOPS)</span>
          <div class="bar-track"><div class="bar-fill" style="width:52%;background:var(--primary);">~10K TPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">High-End (tuned)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--primary),var(--accent));">~19K TPS</div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">Default Connections</td><td><code>max_connections = 151</code> (configurable up to 100K, recommend 500&ndash;1,000 for production)</td></tr>
        <tr><td style="font-weight:600;">p50 / p99 Latency</td><td>1&ndash;5 ms / 10&ndash;30 ms (Aurora: 20&ndash;30 ms p99 for commits)</td></tr>
        <tr><td style="font-weight:600;">Max Storage (RDS)</td><td>Up to 64 TB (R5 instances), shard at ~1 TB</td></tr>
        <tr><td style="font-weight:600;">InnoDB Row Format</td><td>DYNAMIC (default), supports up to 8 KB inline row, rest in overflow pages</td></tr>
        <tr><td style="font-weight:600;">Replication</td><td>Semi-sync / async, Group Replication (MySQL InnoDB Cluster), GTID-based</td></tr>
        <tr><td style="font-weight:600;">Sharding</td><td>Vitess (YouTube/PlanetScale), ProxySQL, application-level, MySQL Fabric (deprecated)</td></tr>
        <tr><td style="font-weight:600;">vs PostgreSQL</td><td>Faster for simple read-heavy workloads; PG better for complex queries, JSON, extensions</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>AWS RDS</th><th>AWS Aurora</th><th>Azure Database</th><th>GCP Cloud SQL</th></tr></thead>
        <tbody>
          <tr><td>Small (2 vCPU)</td><td>$80 &ndash; $130</td><td>$120 &ndash; $200</td><td>$80 &ndash; $120</td><td>$70 &ndash; $110</td></tr>
          <tr><td>Mid (4 vCPU)</td><td>$150 &ndash; $250</td><td>$200 &ndash; $350</td><td>$150 &ndash; $230</td><td>$130 &ndash; $200</td></tr>
          <tr><td>Large (8 vCPU)</td><td>$300 &ndash; $500</td><td>$400 &ndash; $650</td><td>$300 &ndash; $480</td><td>$260 &ndash; $420</td></tr>
        </tbody>
      </table>
    </div>
    <p style="color:var(--text-muted);font-size:0.85em;">Aurora charges separately: compute ($0.10/ACU-hr) + storage ($0.10/GB-month) + I/O ($0.20/million)</p>
  </div>
  <div class="tip-box tip-success">
    <strong>When to Shard MySQL:</strong> When single server maxes out CPU/memory/IOPS, exceeds ~1 TB, or write TPS exceeds 10K&ndash;20K. Use Vitess (the battle-tested sharding solution from YouTube/Slack) or PlanetScale for managed Vitess.
  </div>
</section>

<!-- ==================== ELASTICSEARCH ==================== -->
<section id="elasticsearch">
  <h2><span class="icon" style="background:linear-gradient(135deg,#FEC514,#00BFB3);">&#128269;</span> Elasticsearch</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">SEARCH</span> Query Throughput Per Node</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Complex (agg + geo)</span>
          <div class="bar-track"><div class="bar-fill" style="width:14%;background:#FEC514;color:#000;">~100 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Standard (filter + sort)</span>
          <div class="bar-track"><div class="bar-fill" style="width:42%;background:#FEC514;color:#000;">~300 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Simple (term match)</span>
          <div class="bar-track"><div class="bar-fill" style="width:71%;background:#FEC514;color:#000;">~500 QPS</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Cached (filter cache)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#FEC514,#00BFB3);color:#000;">~700 QPS</div></div>
        </div>
      </div>
      <p style="color:var(--text-muted);font-size:0.85em;">Unlike databases, ES throughput heavily depends on query complexity, shard count, and whether results are cached.</p>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">INDEX</span> Indexing Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">With Analysis</span>
          <div class="bar-track"><div class="bar-fill" style="width:25%;background:var(--primary);">~5K docs/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Bulk Indexing</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--primary),var(--accent));">~20K docs/sec</div></div>
        </div>
      </div>
      <p style="color:var(--text-muted);font-size:0.85em;">Bulk API with 5&ndash;15 MB batches is critical. Individual doc indexing is 10&ndash;50x slower.</p>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">Shard Size</td><td>Optimal: 30&ndash;50 GB per shard. Too small = overhead, too large = slow recovery</td></tr>
        <tr><td style="font-weight:600;">Shards Per Node</td><td>Max ~20 shards per GB of heap. For 32 GB heap &rarr; ~640 shards max</td></tr>
        <tr><td style="font-weight:600;">JVM Heap</td><td>Set to 50% of RAM, max 32 GB (compressed OOPs limit). Give rest to OS page cache.</td></tr>
        <tr><td style="font-weight:600;">p50 / p99 Latency</td><td>5&ndash;50 ms / 100&ndash;500 ms (heavily depends on query type and shard count)</td></tr>
        <tr><td style="font-weight:600;">Near Real-Time</td><td><code>refresh_interval = 1s</code> (default). New docs visible after refresh, not instantly.</td></tr>
        <tr><td style="font-weight:600;">Connections</td><td>HTTP REST API; use connection pooling. No "max connections" like RDBMS.</td></tr>
        <tr><td style="font-weight:600;">Cluster Architecture</td><td>Separate master-eligible, data, and coordinating nodes in production.</td></tr>
        <tr><td style="font-weight:600;">Azure Equivalent</td><td>Azure AI Search (managed, different API) or ES on AKS</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>Elastic Cloud</th><th>AWS OpenSearch</th><th>Azure AI Search</th><th>Self-Managed (VM)</th></tr></thead>
        <tbody>
          <tr><td>Dev/Test (2 vCPU, 8 GB)</td><td>$100 &ndash; $200</td><td>$100 &ndash; $170</td><td>$75 (S1)</td><td>$50 &ndash; $100</td></tr>
          <tr><td>Mid (8 vCPU, 32 GB)</td><td>$400 &ndash; $600</td><td>$350 &ndash; $550</td><td>$300 (S2)</td><td>$200 &ndash; $350</td></tr>
          <tr><td>Large (3-node, 16 vCPU each)</td><td>$1,000 &ndash; $2,000</td><td>$900 &ndash; $1,800</td><td>$750+ (S3)</td><td>$500 &ndash; $900</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tip-box tip-danger">
    <strong>Common Pitfall:</strong> ES is NOT a database. Don't use it as the primary data store. Always keep the source of truth in PostgreSQL/MySQL and sync to ES via CDC (Debezium / Change Data Capture). If ES goes down, you can rebuild from the database.
  </div>
</section>

<!-- ==================== REDIS ==================== -->
<section id="redis">
  <h2><span class="icon" style="background:linear-gradient(135deg,#DC382D,#FF6B6B);">&#9889;</span> Redis</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">OPS</span> Throughput (Single Thread)</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">GET (no pipeline)</span>
          <div class="bar-track"><div class="bar-fill" style="width:5%;background:#DC382D;">~100K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">SET (no pipeline)</span>
          <div class="bar-track"><div class="bar-fill" style="width:4%;background:#DC382D;">~80K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">GET (pipelining)</span>
          <div class="bar-track"><div class="bar-fill" style="width:50%;background:linear-gradient(90deg,#DC382D,#FF6B6B);">~1M ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Enterprise (per node)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#DC382D,var(--accent));">~2M+ ops/sec</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-latency">LATENCY</span> Sub-Millisecond Performance</h4>
      <div class="metric-grid">
        <div class="metric-card">
          <div class="value" style="color:#DC382D;">&lt; 1 ms</div>
          <div class="label">p50 Latency</div>
        </div>
        <div class="metric-card">
          <div class="value" style="color:#DC382D;">1-2 ms</div>
          <div class="label">p99 Latency</div>
        </div>
        <div class="metric-card">
          <div class="value" style="color:#DC382D;">10K</div>
          <div class="label">Default Max Connections</div>
        </div>
        <div class="metric-card">
          <div class="value" style="color:#DC382D;">25 GB</div>
          <div class="label">Max RAM (single node)</div>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">Threading Model</td><td>Single-threaded event loop (Redis 7 uses I/O threads for parsing). CPU core speed matters more than count.</td></tr>
        <tr><td style="font-weight:600;">Persistence</td><td>RDB snapshots (point-in-time) + AOF (append-only log). AOF + <code>appendfsync everysec</code> for durability.</td></tr>
        <tr><td style="font-weight:600;">Data Structures</td><td>Strings, Hashes, Lists, Sets, Sorted Sets, Streams, HyperLogLog, Bitmaps, Geospatial</td></tr>
        <tr><td style="font-weight:600;">Cluster Mode</td><td>Redis Cluster: 16,384 hash slots distributed across nodes. Auto-sharding.</td></tr>
        <tr><td style="font-weight:600;">Max Key Size</td><td>512 MB per key. Recommended: keep values &lt; 100 KB for best performance.</td></tr>
        <tr><td style="font-weight:600;">Memory Overhead</td><td>~60&ndash;100 bytes per key (metadata). Use hash packing for small objects.</td></tr>
        <tr><td style="font-weight:600;">Eviction Policies</td><td><code>allkeys-lru</code> (recommended for caching), <code>volatile-lfu</code>, <code>noeviction</code></td></tr>
        <tr><td style="font-weight:600;">Azure Equivalent</td><td>Azure Cache for Redis (managed, supports Cluster mode)</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>AWS ElastiCache</th><th>Azure Cache for Redis</th><th>GCP Memorystore</th></tr></thead>
        <tbody>
          <tr><td>Small (1.5 GB)</td><td>$25 &ndash; $50</td><td>$20 &ndash; $40</td><td>$30 &ndash; $50</td></tr>
          <tr><td>Mid (6 GB, HA)</td><td>$100 &ndash; $200</td><td>$90 &ndash; $180</td><td>$100 &ndash; $180</td></tr>
          <tr><td>Large (13 GB, HA)</td><td>$200 &ndash; $350</td><td>$180 &ndash; $300</td><td>$200 &ndash; $320</td></tr>
          <tr><td>XL Cluster (6x 26 GB)</td><td>$1,500 &ndash; $2,500</td><td>$1,200 &ndash; $2,000</td><td>$1,400 &ndash; $2,200</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tip-box tip-info">
    <strong>Cost vs Memory:</strong> Redis stores everything in RAM, making it expensive per GB compared to disk-based databases. A rule of thumb: Redis costs ~$15&ndash;$25/GB/month in managed services vs ~$0.10/GB for disk. Only cache hot data, not everything.
  </div>
</section>

<!-- ==================== MONGODB ==================== -->
<section id="mongodb">
  <h2><span class="icon" style="background:linear-gradient(135deg,#00ED64,#001E2B);">&#127809;</span> MongoDB</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">READ</span> Read Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Disk-bound</span>
          <div class="bar-track"><div class="bar-fill" style="width:10%;background:#00ED64;color:#000;">~10K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Mixed (hot data cached)</span>
          <div class="bar-track"><div class="bar-fill" style="width:30%;background:#00ED64;color:#000;">~30K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">In-memory (cached)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#00ED64,#00A651);color:#000;">~100K ops/sec</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">WRITE</span> Write Throughput</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Acknowledged (w:1)</span>
          <div class="bar-track"><div class="bar-fill" style="width:20%;background:var(--primary);">~10K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Bulk Insert</span>
          <div class="bar-track"><div class="bar-fill" style="width:60%;background:var(--primary);">~30K ops/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Unacknowledged (w:0)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--primary),var(--accent));">~50K ops/sec</div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">Max Doc Size</td><td>16 MB per document (use GridFS for larger files)</td></tr>
        <tr><td style="font-weight:600;">Max Connections</td><td>Self-hosted: 65K (OS-limited). Atlas M10: 1,500/node. Atlas M30: 2,000/node.</td></tr>
        <tr><td style="font-weight:600;">p50 / p99 Latency</td><td>0.5&ndash;2 ms (cached) / 5&ndash;50 ms. Disk-bound: 5&ndash;20 ms p50</td></tr>
        <tr><td style="font-weight:600;">WiredTiger Engine</td><td>Document-level locking. Compression: snappy (default), zstd (better ratio)</td></tr>
        <tr><td style="font-weight:600;">Shard Key</td><td>Choose wisely &mdash; immutable after collection is sharded. High cardinality + good distribution is key.</td></tr>
        <tr><td style="font-weight:600;">Replica Set</td><td>Min 3 members (1 primary + 2 secondaries). Auto-failover in ~10&ndash;12 sec.</td></tr>
        <tr><td style="font-weight:600;">Aggregation Pipeline</td><td>Server-side data processing. Can replace many application-level joins.</td></tr>
        <tr><td style="font-weight:600;">Azure Equivalent</td><td>Cosmos DB (MongoDB API compatibility mode)</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>MongoDB Atlas</th><th>AWS DocumentDB</th><th>Cosmos DB (Mongo API)</th></tr></thead>
        <tbody>
          <tr><td>Free (M0, 512 MB)</td><td>$0</td><td>&mdash;</td><td>$0 (1K RU/s free tier)</td></tr>
          <tr><td>Dev/Test (M10)</td><td>$60 &ndash; $80</td><td>$100 &ndash; $150</td><td>$24+ (400 RU/s)</td></tr>
          <tr><td>Production (M30)</td><td>$200 &ndash; $400</td><td>$250 &ndash; $450</td><td>$200 &ndash; $500</td></tr>
          <tr><td>Enterprise (M50+)</td><td>$600 &ndash; $1,500</td><td>$500 &ndash; $1,200</td><td>$500 &ndash; $2,000</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tip-box tip-success">
    <strong>When to Shard MongoDB:</strong> When any single collection approaches 3 TB or throughput exceeds 50K ops/sec per replica set. MongoDB's built-in sharding (mongos router + config servers) makes horizontal scaling relatively smooth compared to RDBMS.
  </div>
</section>

<!-- ==================== CASSANDRA ==================== -->
<section id="cassandra">
  <h2><span class="icon" style="background:linear-gradient(135deg,#1287B1,#5BBCE4);">&#9881;</span> Cassandra</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">READ</span> Read Throughput Per Node</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Standard</span>
          <div class="bar-track"><div class="bar-fill" style="width:10%;background:#1287B1;">~10K reads/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Tuned (4 vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:50%;background:#1287B1;">~50K reads/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Optimized (8+ vCPU)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#1287B1,#5BBCE4);">~100K reads/sec</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">WRITE</span> Write Throughput Per Node</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Standard</span>
          <div class="bar-track"><div class="bar-fill" style="width:25%;background:var(--primary);">~50K writes/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Tuned</span>
          <div class="bar-track"><div class="bar-fill" style="width:50%;background:var(--primary);">~100K writes/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Optimized (SSD)</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--primary),var(--accent));">~200K writes/sec</div></div>
        </div>
      </div>
      <p style="color:var(--text-muted);font-size:0.85em;">Cassandra is write-optimized by design (log-structured merge tree). Writes are ~2x faster than reads.</p>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">p50 / p99 Latency</td><td>Read: 1&ndash;3 ms / 6&ndash;20 ms. Write: 0.5&ndash;1 ms / 5&ndash;10 ms. (v4.0+ is 40&ndash;60% faster than v3.x)</td></tr>
        <tr><td style="font-weight:600;">Consistency Levels</td><td>ONE, QUORUM, ALL, LOCAL_QUORUM, etc. QUORUM = N/2 + 1 nodes must agree.</td></tr>
        <tr><td style="font-weight:600;">Partition Size</td><td>Recommended max: 100 MB per partition. Wider partitions &rarr; higher read latency.</td></tr>
        <tr><td style="font-weight:600;">Storage Per Node</td><td>Optimal: 500 GB &ndash; 1 TB. Max recommended: 3&ndash;5 TB (beyond 1 TB = slow bootstraps).</td></tr>
        <tr><td style="font-weight:600;">Compaction</td><td>STCS (write-heavy), LCS (read-heavy, more I/O), TWCS (time-series). Tuning is critical.</td></tr>
        <tr><td style="font-weight:600;">No JOINs</td><td>No joins, no subqueries, limited aggregation. Denormalize data at write time.</td></tr>
        <tr><td style="font-weight:600;">Scaling</td><td>Linear horizontal scale. Double nodes &asymp; double throughput. Ring architecture with vnodes.</td></tr>
        <tr><td style="font-weight:600;">Azure Equivalent</td><td>Azure Managed Instance for Cassandra, or Cosmos DB (Cassandra API)</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Tier</th><th>AWS Keyspaces (Serverless)</th><th>Self-Managed (3-node)</th><th>Azure Managed Cassandra</th><th>DataStax Astra</th></tr></thead>
        <tbody>
          <tr><td>Dev/Test</td><td>Pay-per-request (~$20&ndash;$50)</td><td>$200 &ndash; $400</td><td>$300 &ndash; $500</td><td>$25+ (serverless)</td></tr>
          <tr><td>Production (3-node)</td><td>$100 &ndash; $500</td><td>$400 &ndash; $1,000</td><td>$600 &ndash; $1,200</td><td>$200 &ndash; $800</td></tr>
          <tr><td>Large (6-node)</td><td>$300 &ndash; $1,500</td><td>$800 &ndash; $2,000</td><td>$1,200 &ndash; $2,500</td><td>$500 &ndash; $2,000</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tip-box tip-info">
    <strong>Cassandra vs DynamoDB:</strong> Cassandra gives you more control (on-prem, multi-cloud, tunable consistency) but requires ops expertise. DynamoDB is fully managed with zero ops, but vendor lock-in and higher cost at scale. Choose DynamoDB for simplicity, Cassandra for control.
  </div>
</section>

<!-- ==================== DYNAMODB / COSMOS DB ==================== -->
<section id="dynamodb">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--accent),var(--warning));">&#9889;</span> DynamoDB / Cosmos DB</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-read">READ</span> DynamoDB Throughput</h4>
      <div class="table-wrap">
        <table>
          <tr><td style="font-weight:600;">On-Demand (burst)</td><td>12K reads/sec initial &rarr; auto-doubles to previous peak</td></tr>
          <tr><td style="font-weight:600;">Per Partition</td><td>3,000 RCU (strongly consistent) / 6,000 RCU (eventually consistent)</td></tr>
          <tr><td style="font-weight:600;">Per Table (provisioned)</td><td>40,000 RCU default, increasable to millions</td></tr>
          <tr><td style="font-weight:600;">1 RCU =</td><td>1 strongly consistent read of up to 4 KB, or 2 eventually consistent reads</td></tr>
          <tr><td style="font-weight:600;">With DAX Cache</td><td>Microsecond reads (&lt; 1 ms), up to 1M reads/sec per DAX cluster</td></tr>
        </table>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">WRITE</span> DynamoDB Throughput</h4>
      <div class="table-wrap">
        <table>
          <tr><td style="font-weight:600;">On-Demand (burst)</td><td>4K writes/sec initial &rarr; auto-doubles</td></tr>
          <tr><td style="font-weight:600;">Per Partition</td><td>1,000 WCU per partition per second</td></tr>
          <tr><td style="font-weight:600;">Per Table (provisioned)</td><td>40,000 WCU default, increasable</td></tr>
          <tr><td style="font-weight:600;">1 WCU =</td><td>1 write of up to 1 KB</td></tr>
          <tr><td style="font-weight:600;">Transactions</td><td>2x the cost (2 RCU for transactional read, 2 WCU for transactional write)</td></tr>
        </table>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">p50 / p99 Latency</td><td>2&ndash;5 ms / 6&ndash;10 ms. With DAX: &lt; 1 ms (microseconds). With hedging: &lt; 6.7 ms p99</td></tr>
        <tr><td style="font-weight:600;">Max Item Size</td><td>400 KB (DynamoDB), 2 MB (Cosmos DB)</td></tr>
        <tr><td style="font-weight:600;">Partition Size</td><td>10 GB per physical partition (auto-split beyond)</td></tr>
        <tr><td style="font-weight:600;">Storage</td><td>Unlimited total. $0.25/GB-month (Dynamo), variable (Cosmos)</td></tr>
        <tr><td style="font-weight:600;">Connections</td><td>HTTP/HTTPS API &mdash; no traditional connection pool needed</td></tr>
        <tr><td style="font-weight:600;">Global Tables</td><td>Multi-region active-active replication with last-writer-wins conflict resolution</td></tr>
        <tr><td style="font-weight:600;">Hot Partition Risk</td><td>The #1 problem. If one partition key gets &gt; 3K RCU or 1K WCU, requests throttle.</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Mode</th><th>DynamoDB (AWS)</th><th>Cosmos DB (Azure)</th><th>Notes</th></tr></thead>
        <tbody>
          <tr><td>On-Demand (light)</td><td>$1.25/M writes, $0.25/M reads</td><td>~$0.28/100 RU writes</td><td>Best for spiky, unpredictable traffic</td></tr>
          <tr><td>Provisioned (100 RCU + 100 WCU)</td><td>~$45/month</td><td>~$58/month (400 RU/s)</td><td>Best for steady, predictable traffic</td></tr>
          <tr><td>Provisioned (1K RCU + 1K WCU)</td><td>~$450/month</td><td>~$584/month (10K RU/s)</td><td>Cosmos is 25&ndash;30% more expensive</td></tr>
          <tr><td>Storage (100 GB)</td><td>$25/month</td><td>$25/month</td><td>Similar across both</td></tr>
          <tr><td>Global Tables (2 regions)</td><td>~2x base cost</td><td>~2x base cost</td><td>Replication doubles throughput costs</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tip-box tip-danger">
    <strong>Hidden DynamoDB Costs:</strong> (1) On-demand mode can be 5&ndash;7x more expensive than provisioned for sustained workloads. (2) Scans are expensive &mdash; they consume RCU for every page. (3) Streams cost $0.02/100K read requests. (4) Global tables double your bill. Always estimate costs before committing.
  </div>
</section>

<!-- ==================== KAFKA / EVENT HUBS ==================== -->
<section id="kafka">
  <h2><span class="icon" style="background:linear-gradient(135deg,#231F20,#FFFFFF);">&#128229;</span> Kafka / Event Hubs</h2>
  <div class="card-grid">
    <div class="card">
      <h4><span class="compare-badge cb-write">THROUGHPUT</span> Kafka Per Broker</h4>
      <div class="bar-chart">
        <div class="bar-row">
          <span class="bar-label">Conservative</span>
          <div class="bar-track"><div class="bar-fill" style="width:20%;background:var(--text);">~50K msg/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Typical Production</span>
          <div class="bar-track"><div class="bar-fill" style="width:50%;background:var(--text);">~100K-200K msg/sec</div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">3-Node Cluster</span>
          <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,var(--text-muted),var(--text));">~2M msg/sec</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4><span class="compare-badge cb-write">THROUGHPUT</span> Azure Event Hubs</h4>
      <div class="table-wrap">
        <table>
          <tr><td style="font-weight:600;">Per Throughput Unit (TU)</td><td>1 MB/s ingress, 2 MB/s egress, 1,000 events/sec</td></tr>
          <tr><td style="font-weight:600;">Standard (20 TUs max)</td><td>20 MB/s ingress, 40 MB/s egress</td></tr>
          <tr><td style="font-weight:600;">Premium (100 PUs)</td><td>~1.8M events/sec</td></tr>
          <tr><td style="font-weight:600;">Dedicated (CU)</td><td>100&ndash;250 MB/s per Capacity Unit</td></tr>
        </table>
      </div>
    </div>
  </div>
  <div class="card">
    <h4>&#128203; Key Specs &amp; Characteristics</h4>
    <div class="table-wrap">
      <table>
        <tr><td style="width:200px;font-weight:600;">p50 / p99 Latency</td><td>10&ndash;50 ms / 50&ndash;100 ms. Ultra-low (trading): &lt;5 ms p99 (sub-5KB messages)</td></tr>
        <tr><td style="font-weight:600;">Partitions Per Topic</td><td>Practical max: 4K&ndash;10K per cluster. Each partition = sequential log on disk.</td></tr>
        <tr><td style="font-weight:600;">Consumer Parallelism</td><td>Max consumers in a group = number of partitions. More partitions = more parallelism.</td></tr>
        <tr><td style="font-weight:600;">Retention</td><td>Time-based (default 7 days) or size-based. Confluent Cloud: moving to unlimited.</td></tr>
        <tr><td style="font-weight:600;">Replication Factor</td><td>Typically 3 (RF=3). Min.insync.replicas=2 for durability with acks=all.</td></tr>
        <tr><td style="font-weight:600;">Message Size</td><td>Default max: 1 MB. Configurable, but large messages hurt throughput. Use claim-check pattern for &gt;1 MB.</td></tr>
        <tr><td style="font-weight:600;">Exactly-Once</td><td>Supported since Kafka 0.11 with idempotent producers + transactional consumers.</td></tr>
        <tr><td style="font-weight:600;">Storage Per Broker</td><td>Typically 1&ndash;10 TB SSD. Storage proportional to retention period &times; throughput.</td></tr>
      </table>
    </div>
  </div>
  <div class="card">
    <h4>&#128176; Cost Estimates (Monthly)</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Offering</th><th>Small (Dev)</th><th>Mid (Production)</th><th>Large (High-Throughput)</th></tr></thead>
        <tbody>
          <tr><td style="font-weight:600;">AWS MSK (3-broker)</td><td>$200 &ndash; $300</td><td>$330 &ndash; $440</td><td>$800 &ndash; $1,500</td></tr>
          <tr><td style="font-weight:600;">Confluent Cloud</td><td>$100 &ndash; $200</td><td>$300 &ndash; $600</td><td>$1,000 &ndash; $3,000+</td></tr>
          <tr><td style="font-weight:600;">Azure Event Hubs (Standard)</td><td>$20 (1 TU)</td><td>$100 &ndash; $200 (5-10 TU)</td><td>$400+ (20 TU)</td></tr>
          <tr><td style="font-weight:600;">Azure Event Hubs (Premium)</td><td>$153 (1 PU)</td><td>$450 &ndash; $750 (3-5 PU)</td><td>$1,500+ (10 PU)</td></tr>
          <tr><td style="font-weight:600;">Self-Managed (3-node VMs)</td><td>$150 &ndash; $300</td><td>$300 &ndash; $600</td><td>$600 &ndash; $1,200</td></tr>
        </tbody>
      </table>
    </div>
    <p style="color:var(--text-muted);font-size:0.85em;">MSK hidden costs: cross-AZ data transfer can be 50%+ of the bill. Confluent Cloud includes connectors and Schema Registry.</p>
  </div>
  <div class="tip-box">
    <strong>Kafka Scaling Rule of Thumb:</strong> 1 partition &asymp; 10K&ndash;50K msg/sec throughput. Need 500K msg/sec? Plan for ~10&ndash;50 partitions minimum. Add brokers when cluster disk/CPU/network saturates. Consumer lag is the key metric to watch.
  </div>
</section>

<!-- ==================== VISUAL THROUGHPUT COMPARISON ==================== -->
<section id="throughput-visual">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--blue),var(--purple));">&#128200;</span> Visual Throughput Comparison</h2>

  <h3>Read Throughput (ops/sec per instance, log-scale mental model)</h3>
  <div class="card">
    <div class="bar-chart">
      <div class="bar-row">
        <span class="bar-label" style="color:#FEC514;">Elasticsearch</span>
        <div class="bar-track"><div class="bar-fill" style="width:0.7%;background:#FEC514;color:#000;min-width:100px;">100 &ndash; 700 QPS</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--blue);">PostgreSQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:7%;background:var(--blue);min-width:100px;">5K &ndash; 70K QPS</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00758f;">MySQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:23%;background:#00758f;min-width:100px;">10K &ndash; 230K QPS</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00ED64;">MongoDB</span>
        <div class="bar-track"><div class="bar-fill" style="width:10%;background:#00ED64;color:#000;min-width:100px;">10K &ndash; 100K ops/sec</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#1287B1;">Cassandra</span>
        <div class="bar-track"><div class="bar-fill" style="width:10%;background:#1287B1;min-width:100px;">10K &ndash; 100K reads/sec</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#DC382D;">Redis</span>
        <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#DC382D,#FF6B6B);min-width:100px;">80K &ndash; 1M+ ops/sec</div></div>
      </div>
    </div>
    <p style="color:var(--text-muted);font-size:0.82em;margin-top:10px;">Not to exact scale &mdash; ranges vary widely by config. Redis dominates due to in-memory, single-thread efficiency.</p>
  </div>

  <h3>Write Throughput (ops/sec per instance)</h3>
  <div class="card">
    <div class="bar-chart">
      <div class="bar-row">
        <span class="bar-label" style="color:var(--blue);">PostgreSQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:7.5%;background:var(--blue);min-width:100px;">2K &ndash; 15K TPS</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00758f;">MySQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:9.5%;background:#00758f;min-width:100px;">2K &ndash; 19K TPS</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#FEC514;">Elasticsearch</span>
        <div class="bar-track"><div class="bar-fill" style="width:10%;background:#FEC514;color:#000;min-width:100px;">5K &ndash; 20K docs/sec</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00ED64;">MongoDB</span>
        <div class="bar-track"><div class="bar-fill" style="width:25%;background:#00ED64;color:#000;min-width:100px;">5K &ndash; 50K ops/sec</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#DC382D;">Redis</span>
        <div class="bar-track"><div class="bar-fill" style="width:50%;background:linear-gradient(90deg,#DC382D,#FF6B6B);min-width:100px;">80K &ndash; 100K ops/sec</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#1287B1;">Cassandra</span>
        <div class="bar-track"><div class="bar-fill" style="width:100%;background:linear-gradient(90deg,#1287B1,#5BBCE4);min-width:100px;">50K &ndash; 200K writes/sec</div></div>
      </div>
    </div>
    <p style="color:var(--text-muted);font-size:0.82em;margin-top:10px;">Cassandra's log-structured storage makes it the write throughput champion among persistent stores.</p>
  </div>

  <h3>Latency Comparison (p99, lower is better)</h3>
  <div class="card">
    <div class="bar-chart">
      <div class="bar-row">
        <span class="bar-label" style="color:#DC382D;">Redis</span>
        <div class="bar-track"><div class="bar-fill" style="width:4%;background:#DC382D;min-width:60px;">1&ndash;2 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--accent);">DynamoDB</span>
        <div class="bar-track"><div class="bar-fill" style="width:12%;background:var(--accent);min-width:60px;">6&ndash;10 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#1287B1;">Cassandra</span>
        <div class="bar-track"><div class="bar-fill" style="width:16%;background:#1287B1;min-width:60px;">6&ndash;20 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--blue);">PostgreSQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:22%;background:var(--blue);min-width:60px;">10&ndash;30 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00758f;">MySQL</span>
        <div class="bar-track"><div class="bar-fill" style="width:22%;background:#00758f;min-width:60px;">10&ndash;30 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00ED64;">MongoDB</span>
        <div class="bar-track"><div class="bar-fill" style="width:36%;background:#00ED64;color:#000;min-width:60px;">5&ndash;50 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--text-muted);">Kafka (e2e)</span>
        <div class="bar-track"><div class="bar-fill" style="width:62%;background:var(--text-muted);min-width:60px;">50&ndash;100 ms</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#FEC514;">Elasticsearch</span>
        <div class="bar-track"><div class="bar-fill" style="width:100%;background:#FEC514;color:#000;min-width:60px;">100&ndash;500 ms</div></div>
      </div>
    </div>
  </div>
</section>

<!-- ==================== WHEN TO SHARD DECISION MATRIX ==================== -->
<section id="shard-decision">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--warning),var(--accent));">&#129300;</span> When to Shard? Decision Matrix</h2>

  <div class="card">
    <h4>Shard Trigger Thresholds</h4>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Service</th>
            <th>Storage Trigger</th>
            <th>Throughput Trigger</th>
            <th>Sharding Approach</th>
            <th>Difficulty</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="service-name service-pg">PostgreSQL</span></td>
            <td>&gt; 1&ndash;5 TB per node</td>
            <td>&gt; 10K&ndash;15K write TPS</td>
            <td>Citus, app-level, FDW</td>
            <td><span class="decision-cell score-1">Hard</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-mysql">MySQL</span></td>
            <td>&gt; 1 TB per node</td>
            <td>&gt; 10K&ndash;20K write TPS</td>
            <td>Vitess, ProxySQL, app-level</td>
            <td><span class="decision-cell score-1">Hard</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-es">Elasticsearch</span></td>
            <td>&gt; 50 GB per shard</td>
            <td>&gt; 700 QPS per node</td>
            <td>Built-in (add nodes &amp; shards)</td>
            <td><span class="decision-cell score-4">Easy</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-redis">Redis</span></td>
            <td>&gt; 25 GB per node (RAM)</td>
            <td>&gt; 100K ops/sec</td>
            <td>Redis Cluster (16K hash slots)</td>
            <td><span class="decision-cell score-3">Medium</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-mongo">MongoDB</span></td>
            <td>&gt; 3 TB per collection</td>
            <td>&gt; 50K ops/sec per replica set</td>
            <td>Built-in (mongos, config servers)</td>
            <td><span class="decision-cell score-3">Medium</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-cassandra">Cassandra</span></td>
            <td>&gt; 500 GB&ndash;1 TB/node</td>
            <td>Linear scaling from day 1</td>
            <td>Built-in (add nodes to ring)</td>
            <td><span class="decision-cell score-5">Trivial</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-dynamo">DynamoDB</span></td>
            <td>N/A (unlimited)</td>
            <td>N/A (auto-scales)</td>
            <td>Automatic (managed by AWS)</td>
            <td><span class="decision-cell score-5">Trivial</span></td>
          </tr>
          <tr>
            <td><span class="service-name service-kafka">Kafka</span></td>
            <td>Add retention / brokers</td>
            <td>&gt; 50K msg/sec per partition</td>
            <td>Add partitions &amp; brokers</td>
            <td><span class="decision-cell score-3">Medium</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <h3>Decision Flowchart: Do I Need to Shard?</h3>
  <div class="card">
    <svg viewBox="0 0 900 420" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:900px;display:block;margin:0 auto;">
      <!-- Start -->
      <rect x="340" y="10" width="220" height="45" rx="22" fill="#428BF9" opacity="0.2" stroke="#428BF9"/>
      <text x="450" y="38" fill="#428BF9" font-size="14" font-weight="700" text-anchor="middle">Is single-node struggling?</text>

      <!-- No branch -->
      <line x1="340" y1="32" x2="120" y2="32" stroke="#10b981" stroke-width="2"/>
      <text x="230" y="25" fill="#10b981" font-size="12" font-weight="700">NO</text>
      <rect x="10" y="12" width="120" height="40" rx="8" fill="#10b981" opacity="0.2" stroke="#10b981"/>
      <text x="70" y="37" fill="#10b981" font-size="13" font-weight="700" text-anchor="middle">Don't Shard</text>

      <!-- Yes arrow down -->
      <line x1="450" y1="55" x2="450" y2="90" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowY)"/>
      <text x="462" y="78" fill="#f59e0b" font-size="12" font-weight="700">YES</text>

      <!-- Step 1 -->
      <rect x="290" y="90" width="320" height="40" rx="8" fill="#f8fafc" stroke="#f59e0b"/>
      <text x="450" y="115" fill="#f59e0b" font-size="13" font-weight="600" text-anchor="middle">1. Optimize queries &amp; add indexes</text>

      <line x1="450" y1="130" x2="450" y2="160" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowY)"/>
      <text x="462" y="150" fill="#f59e0b" font-size="11">still struggling?</text>

      <!-- Step 2 -->
      <rect x="290" y="160" width="320" height="40" rx="8" fill="#f8fafc" stroke="#f59e0b"/>
      <text x="450" y="185" fill="#f59e0b" font-size="13" font-weight="600" text-anchor="middle">2. Add read replicas</text>

      <line x1="450" y1="200" x2="450" y2="230" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowY)"/>

      <!-- Step 3 -->
      <rect x="290" y="230" width="320" height="40" rx="8" fill="#f8fafc" stroke="#f59e0b"/>
      <text x="450" y="255" fill="#f59e0b" font-size="13" font-weight="600" text-anchor="middle">3. Vertical scale (bigger instance)</text>

      <line x1="450" y1="270" x2="450" y2="300" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowY)"/>

      <!-- Step 4 -->
      <rect x="290" y="300" width="320" height="40" rx="8" fill="#f8fafc" stroke="#f59e0b"/>
      <text x="450" y="325" fill="#f59e0b" font-size="13" font-weight="600" text-anchor="middle">4. Partition tables (range/hash)</text>

      <line x1="450" y1="340" x2="450" y2="370" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowR)"/>

      <!-- Shard -->
      <rect x="310" y="370" width="280" height="45" rx="22" fill="#ef4444" opacity="0.2" stroke="#ef4444"/>
      <text x="450" y="398" fill="#ef4444" font-size="14" font-weight="700" text-anchor="middle">5. Shard (last resort for RDBMS)</text>

      <!-- Arrow markers -->
      <defs>
        <marker id="arrowY" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
        </marker>
        <marker id="arrowR" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
        </marker>
      </defs>

      <!-- Side note -->
      <rect x="660" y="90" width="220" height="120" rx="10" fill="rgba(0,166,153,0.1)" stroke="var(--secondary)"/>
      <text x="770" y="115" fill="#00A699" font-size="12" font-weight="700" text-anchor="middle">For NoSQL (Cassandra,</text>
      <text x="770" y="132" fill="#00A699" font-size="12" font-weight="700" text-anchor="middle">DynamoDB, MongoDB):</text>
      <text x="770" y="155" fill="#94a3b8" font-size="11" text-anchor="middle">Sharding is built-in.</text>
      <text x="770" y="172" fill="#94a3b8" font-size="11" text-anchor="middle">Just add nodes.</text>
      <text x="770" y="195" fill="#94a3b8" font-size="11" text-anchor="middle">Design partition key well.</text>
      <line x1="610" y1="110" x2="660" y2="110" stroke="#00A699" stroke-width="1.5" stroke-dasharray="5,3"/>
    </svg>
  </div>

  <div class="tip-box">
    <strong>Interview Golden Rule:</strong> "Shard RDBMS only as a last resort. First try: indexing &rarr; read replicas &rarr; vertical scaling &rarr; table partitioning. For NoSQL, sharding is expected from day 1 &mdash; the key is choosing the right partition key."
  </div>
</section>

<!-- ==================== COST COMPARISON SUMMARY ==================== -->
<section id="cost-comparison">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--success),var(--warning));">&#128176;</span> Cost Comparison Summary</h2>

  <h3>Monthly Cost for a Mid-Tier Production Instance (AWS)</h3>
  <div class="card">
    <div class="bar-chart">
      <div class="bar-row">
        <span class="bar-label" style="color:var(--text-muted);">Event Hubs (Std)</span>
        <div class="bar-track"><div class="bar-fill" style="width:2%;background:var(--secondary);min-width:70px;">$20</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#DC382D;">Redis (6 GB HA)</span>
        <div class="bar-track"><div class="bar-fill" style="width:12%;background:#DC382D;min-width:70px;">$100-$200</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00758f;">MySQL (4 vCPU)</span>
        <div class="bar-track"><div class="bar-fill" style="width:18%;background:#00758f;min-width:70px;">$150-$250</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--blue);">PostgreSQL (4 vCPU)</span>
        <div class="bar-track"><div class="bar-fill" style="width:22%;background:var(--blue);min-width:70px;">$200-$350</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#00ED64;">MongoDB Atlas (M30)</span>
        <div class="bar-track"><div class="bar-fill" style="width:25%;background:#00ED64;color:#000;min-width:70px;">$200-$400</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--text);">Kafka MSK (3-broker)</span>
        <div class="bar-track"><div class="bar-fill" style="width:32%;background:var(--text-muted);min-width:70px;">$330-$440</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#FEC514;">Elasticsearch (8 vCPU)</span>
        <div class="bar-track"><div class="bar-fill" style="width:42%;background:#FEC514;color:#000;min-width:70px;">$350-$550</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:var(--accent);">DynamoDB (1K RCU+WCU)</span>
        <div class="bar-track"><div class="bar-fill" style="width:35%;background:var(--accent);min-width:70px;">$450</div></div>
      </div>
      <div class="bar-row">
        <span class="bar-label" style="color:#1287B1;">Cassandra (3-node)</span>
        <div class="bar-track"><div class="bar-fill" style="width:60%;background:#1287B1;min-width:70px;">$400-$1,000</div></div>
      </div>
    </div>
    <p style="color:var(--text-muted);font-size:0.82em;margin-top:12px;">Costs are approximate and vary by region, reserved instances, and configuration. Does not include data transfer, backups, or support tiers.</p>
  </div>

  <div class="card">
    <h4>&#128161; Cost Optimization Tips</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Strategy</th><th>Savings</th><th>Applicable To</th></tr></thead>
        <tbody>
          <tr><td style="font-weight:600;">Reserved Instances (1-3 yr)</td><td>30&ndash;60% off on-demand</td><td>All managed databases (RDS, ElastiCache, etc.)</td></tr>
          <tr><td style="font-weight:600;">Right-Sizing</td><td>20&ndash;40% by reducing over-provisioning</td><td>All services</td></tr>
          <tr><td style="font-weight:600;">Read Replicas for reads</td><td>Avoid scaling primary (cheaper replicas)</td><td>PostgreSQL, MySQL, MongoDB</td></tr>
          <tr><td style="font-weight:600;">Spot/Preemptible for non-critical</td><td>60&ndash;80% off</td><td>Elasticsearch data nodes, Cassandra (careful)</td></tr>
          <tr><td style="font-weight:600;">Tiered Storage</td><td>50&ndash;70% on old data</td><td>Elasticsearch (warm/cold), Kafka (tiered storage)</td></tr>
          <tr><td style="font-weight:600;">On-Demand &rarr; Provisioned</td><td>5&ndash;7x savings for steady traffic</td><td>DynamoDB, Cosmos DB</td></tr>
          <tr><td style="font-weight:600;">Cache-First Architecture</td><td>80&ndash;90% fewer DB reads</td><td>Redis/Memcached in front of any database</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== INTERVIEW CHEAT SHEET ==================== -->
<section id="interview-cheat">
  <h2><span class="icon" style="background:linear-gradient(135deg,var(--purple),var(--primary));">&#127891;</span> Interview Cheat Sheet</h2>
  <div class="card">
    <h4>Quick-Reference Numbers to Memorize</h4>
    <div class="table-wrap">
      <table>
        <thead><tr><th>What</th><th>Number</th><th>Mnemonic</th></tr></thead>
        <tbody>
          <tr><td>Redis ops/sec (single instance)</td><td><strong>100K</strong></td><td>"Redis = 100K"</td></tr>
          <tr><td>Redis with pipelining</td><td><strong>1M+</strong></td><td>"Pipeline = 10x"</td></tr>
          <tr><td>PostgreSQL read QPS (mid-tier)</td><td><strong>5K</strong></td><td>"PG = 5K reads"</td></tr>
          <tr><td>PostgreSQL write TPS (mid-tier)</td><td><strong>5K</strong></td><td>"PG = 5K writes"</td></tr>
          <tr><td>MySQL read QPS (mid-tier)</td><td><strong>50K</strong></td><td>"MySQL = 10x PG reads (simple)"</td></tr>
          <tr><td>Elasticsearch QPS (per node)</td><td><strong>100&ndash;700</strong></td><td>"ES = hundreds, not thousands"</td></tr>
          <tr><td>Cassandra writes/sec (per node)</td><td><strong>50K&ndash;200K</strong></td><td>"Cassandra = write machine"</td></tr>
          <tr><td>Kafka msgs/sec (per broker)</td><td><strong>100K&ndash;200K</strong></td><td>"Kafka broker = 100K&ndash;200K"</td></tr>
          <tr><td>DynamoDB single partition limit</td><td><strong>3K RCU / 1K WCU</strong></td><td>"3-1 Rule"</td></tr>
          <tr><td>Seconds in a day</td><td><strong>86,400 &asymp; 10<sup>5</sup></strong></td><td>"~100K seconds/day"</td></tr>
          <tr><td>1 PG connection memory</td><td><strong>~10 MB</strong></td><td>"100 conns = 1 GB RAM"</td></tr>
          <tr><td>Redis memory per key</td><td><strong>~100 bytes overhead</strong></td><td>"10M keys = ~1 GB overhead"</td></tr>
          <tr><td>ES shard sweet spot</td><td><strong>30&ndash;50 GB</strong></td><td>"Shards = tens of GB"</td></tr>
          <tr><td>Cassandra node storage sweet spot</td><td><strong>500 GB &ndash; 1 TB</strong></td><td>"~1 TB per Cassandra node"</td></tr>
          <tr><td>MongoDB shard trigger</td><td><strong>3 TB per collection</strong></td><td>"Mongo = 3 TB then shard"</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h4>The "How Many Instances?" Formula</h4>
    <div style="background:var(--darker);border-radius:10px;padding:20px;margin:10px 0;font-family:'Cascadia Code','Fira Code',monospace;font-size:0.9em;">
      <p style="color:var(--warning);margin-bottom:8px;">// Step 1: Calculate required throughput</p>
      <p>Required QPS = Daily requests / 86,400</p>
      <p>Peak QPS = Required QPS &times; 3 (3x safety factor)</p>
      <br>
      <p style="color:var(--warning);margin-bottom:8px;">// Step 2: Divide by single-instance capacity</p>
      <p>Min instances = Peak QPS / Single-instance capacity</p>
      <br>
      <p style="color:var(--warning);margin-bottom:8px;">// Step 3: Add HA overhead</p>
      <p>Total instances = Min instances &times; (1 + replication factor)</p>
      <br>
      <p style="color:var(--secondary);margin-bottom:8px;">// Example: 500K reads/sec peak with PostgreSQL</p>
      <p>Min PG instances = 500K / 5K = <span style="color:var(--primary);font-weight:700;">100 read replicas</span></p>
      <p style="color:var(--text-muted);">// That's way too many PG nodes &mdash; use Redis cache instead</p>
      <p>After Redis (80% cache hit): 500K &times; 0.2 = 100K / 5K = <span style="color:var(--success);font-weight:700;">20 PG read replicas</span></p>
      <p>Redis nodes needed: 500K &times; 0.8 = 400K / 100K = <span style="color:#DC382D;font-weight:700;">4 Redis nodes</span></p>
    </div>
  </div>

  <div class="tip-box tip-success">
    <strong>Final Interview Advice:</strong> Don't memorize exact numbers &mdash; memorize the <em>order of magnitude</em>. Knowing "Redis handles ~100K ops/sec" is more useful than debating whether it's 80K or 120K. Interviewers want to see you reason about capacity, not recite benchmarks.
  </div>
</section>

</div><!-- /container -->

<footer>
  <p><strong>Airbnb System Design</strong> &mdash; Infrastructure Capacity Reference</p>
  <p style="margin-top:8px;"><a href="index.html">&larr; Back to Main System Design Document</a></p>
  <p style="margin-top:8px; font-size:0.8em;">
    Data sourced from official documentation, published benchmarks, and community testing.
    Numbers are approximate &mdash; always benchmark with your own workload.
  </p>
</footer>

<script>
(function(){
  document.querySelectorAll(".diagram-box").forEach(function(box){
    var svg=box.querySelector("svg");
    if(!svg) return;
    var zoom=1, minZ=0.5, maxZ=3;
    var ctrl=document.createElement("div");
    ctrl.className="diagram-zoom-controls";
    ctrl.innerHTML='<button class="zoom-out" title="Zoom Out"></button><span class="zoom-level">100%</span><button class="zoom-in" title="Zoom In">+</button><button class="zoom-reset" title="Reset"></button><button class="zoom-fs" title="Fullscreen"></button>';
    box.insertBefore(ctrl,box.firstChild);
    var lvl=ctrl.querySelector(".zoom-level");
    function apply(){svg.style.transform="scale("+zoom+")";lvl.textContent=Math.round(zoom*100)+"%";}
    ctrl.querySelector(".zoom-in").onclick=function(){zoom=Math.min(maxZ,zoom+0.25);apply();};
    ctrl.querySelector(".zoom-out").onclick=function(){zoom=Math.max(minZ,zoom-0.25);apply();};
    ctrl.querySelector(".zoom-reset").onclick=function(){zoom=1;apply();};
    ctrl.querySelector(".zoom-fs").onclick=function(){
      box.classList.toggle("fullscreen");
      if(box.classList.contains("fullscreen")){this.textContent="";zoom=1.2;}else{this.textContent="";zoom=1;}
      apply();
    };
    box.addEventListener("wheel",function(e){
      if(e.ctrlKey){e.preventDefault();zoom=e.deltaY<0?Math.min(maxZ,zoom+0.1):Math.max(minZ,zoom-0.1);apply();}
    },{passive:false});
  });
})();
</script>
</body>
</html>
